<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Convert isolines or isobands to sfg object — iso_to_sfg • isoband</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Convert isolines or isobands to sfg object — iso_to_sfg" />
<meta property="og:description" content="Convert isolines or isobands to an sf geometry collection (sfg) object. Further downstream
processing needs to happen via the sf package." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">isoband</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/isoband1.html">1. Generating isolines and isobands</a>
    </li>
    <li>
      <a href="../articles/isoband2.html">2. Simple features</a>
    </li>
    <li>
      <a href="../articles/isoband3.html">3. Labeled isolines</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/wilkelab/isoband/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert isolines or isobands to sfg object</h1>
    <small class="dont-index">Source: <a href='https://github.com/wilkelab/isoband/blob/master/R/iso-to-sfg.R'><code>R/iso-to-sfg.R</code></a></small>
    <div class="hidden name"><code>iso_to_sfg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Convert isolines or isobands to an sf geometry collection (<code>sfg</code>) object. Further downstream
processing needs to happen via the sf package.</p>
    </div>

    <pre class="usage"><span class='fu'>iso_to_sfg</span>(<span class='kw'>x</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>The object to convert.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function <code>iso_to_sfg()</code> is a generic that takes an object created by either <code><a href='isobands.html'>isolines()</a></code>
or <code><a href='isobands.html'>isobands()</a></code> and turns it into a simple features (sf) geometry collection. Importantly,
the isobanding algorithm can produce polygons that do not represent valid simple features. This
happens usually when the lower limit of an isoband is exactly equal to some data values (see
examples for a demonstration). This can be worked around either by slightly shifting the data
or band limits (e.g., round all data values and then shift them by a value smaller than the
rounding error) or by fixing the geometries using the function <code><a href='https://rdrr.io/pkg/sf/man/valid.html'>st_make_valid()</a></code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://r-spatial.github.io/sf'>sf</a></span>)
</div><div class='output co'>#&gt; <span class='message'>Linking to GEOS 3.8.1, GDAL 3.1.1, PROJ 6.3.1</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='http://ggplot2.tidyverse.org'>ggplot2</a></span>)

<span class='co'># Example 1: simple 5x5 matrix</span>
<span class='kw'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>0</span>,
              <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span>,
              <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>,
              <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span>,
              <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>), <span class='fl'>5</span>, <span class='fl'>5</span>, byrow = <span class='fl'>TRUE</span>)

<span class='kw'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='isobands.html'>isolines</a></span>(<span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='kw'>m</span>), <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='kw'>m</span>)<span class='op'>:</span><span class='fl'>1</span>, <span class='kw'>m</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.5</span>, <span class='fl'>1.5</span>))
<span class='kw'>lines</span> <span class='op'>&lt;-</span> <span class='fu'>iso_to_sfg</span>(<span class='kw'>z</span>)
<span class='kw'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sf.html'>st_sf</a></span>(level = <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='kw'>lines</span>), geometry = <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sfc.html'>st_sfc</a></span>(<span class='kw'>lines</span>))
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='kw'>x</span>) <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span>(<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(color = <span class='kw'>level</span>))
</div><div class='img'><img src='iso_to_sfg-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Example 2: volcano dataset</span>
<span class='kw'>m</span> <span class='op'>&lt;-</span> <span class='kw'>volcano</span>
<span class='kw'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='isobands.html'>isobands</a></span>((<span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='kw'>m</span>))<span class='op'>/</span>(<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='kw'>m</span>)<span class='op'>+</span><span class='fl'>1</span>), (<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='kw'>m</span>)<span class='op'>:</span><span class='fl'>1</span>)<span class='op'>/</span>(<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='kw'>m</span>)<span class='op'>+</span><span class='fl'>1</span>), <span class='kw'>m</span>,
              <span class='fl'>10</span><span class='op'>*</span><span class='fl'>9</span><span class='op'>:</span><span class='fl'>19</span>, <span class='fl'>10</span><span class='op'>*</span><span class='fl'>10</span><span class='op'>:</span><span class='fl'>20</span>)
<span class='kw'>bands</span> <span class='op'>&lt;-</span> <span class='fu'>iso_to_sfg</span>(<span class='kw'>b</span>)
<span class='kw'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sf.html'>st_sf</a></span>(level = <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span>(<span class='st'>":.*"</span>, <span class='st'>""</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='kw'>bands</span>))), geometry = <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sfc.html'>st_sfc</a></span>(<span class='kw'>bands</span>))
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='kw'>x</span>) <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span>(<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(color = <span class='kw'>level</span>, fill = <span class='kw'>level</span>))
</div><div class='img'><img src='iso_to_sfg-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Example 3: invalid simple features</span>
<span class='kw'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1.5</span>, <span class='fl'>1.5</span>, <span class='fl'>1.5</span>, <span class='fl'>1.5</span>, <span class='fl'>0.6</span>,
              <span class='fl'>0.5</span>, <span class='fl'>1.5</span>, <span class='fl'>1.5</span>,   <span class='fl'>0</span>,   <span class='fl'>0</span>,
                <span class='fl'>0</span>,   <span class='fl'>1</span>,   <span class='fl'>0</span>,   <span class='fl'>1</span>,   <span class='fl'>1</span>,
                <span class='fl'>0</span>,   <span class='fl'>1</span>,   <span class='fl'>0</span>, <span class='fl'>0.7</span>,   <span class='fl'>0</span>,
              <span class='fl'>0.9</span>, <span class='fl'>1.3</span>, <span class='fl'>1.8</span>, <span class='fl'>1.4</span>, <span class='fl'>0.4</span>), <span class='fl'>5</span>, <span class='fl'>5</span>, byrow = <span class='fl'>TRUE</span>)

<span class='kw'>raw</span> <span class='op'>&lt;-</span> <span class='fu'><a href='isobands.html'>isobands</a></span>(<span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span>, <span class='fl'>5</span><span class='op'>:</span><span class='fl'>1</span>, <span class='kw'>m</span>, levels_low = <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, levels_high = <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>)
<span class='kw'>bands</span> <span class='op'>&lt;-</span> <span class='fu'>iso_to_sfg</span>(<span class='kw'>raw</span>)

<span class='kw'>iso</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sf.html'>st_sf</a></span>(
  id = <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='kw'>bands</span>)),
  geometry = <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sfc.html'>st_sfc</a></span>(<span class='kw'>bands</span>)
)

<span class='co'># the geometries are not valid</span>
<span class='fu'><a href='https://rdrr.io/pkg/sf/man/valid.html'>st_is_valid</a></span>(<span class='kw'>iso</span>, reason = <span class='fl'>TRUE</span>)
</div><div class='output co'>#&gt; [1] "Self-intersection[2 2]"                   
#&gt; [2] "Too few points in geometry component[4 3]"</div><div class='input'><span class='co'># this doesn't prevent us from plotting them</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='kw'>iso</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(fill = <span class='kw'>id</span>)) <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span>()
</div><div class='img'><img src='iso_to_sfg-3.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># make all geometries valid</span>
<span class='kw'>iso2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sf/man/valid.html'>st_make_valid</a></span>(<span class='kw'>iso</span>)
<span class='fu'><a href='https://rdrr.io/pkg/sf/man/valid.html'>st_is_valid</a></span>(<span class='kw'>iso2</span>, reason=<span class='fl'>TRUE</span>)
</div><div class='output co'>#&gt; [1] "Valid Geometry" "Valid Geometry"</div><div class='input'><span class='co'># the plot looks unchanged (this is not always the case)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='kw'>iso2</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(fill = <span class='kw'>id</span>)) <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span>()
</div><div class='img'><img src='iso_to_sfg-4.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># alternatively, if we shift all data values by a tiny</span>
<span class='co'># amount (here, 1e-10) so they don't coincide with the band</span>
<span class='co'># limits, no invalid geometries are generated.</span>
<span class='kw'>raw</span> <span class='op'>&lt;-</span> <span class='fu'><a href='isobands.html'>isobands</a></span>(<span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span>, <span class='fl'>5</span><span class='op'>:</span><span class='fl'>1</span>, <span class='kw'>m</span> <span class='op'>+</span> <span class='fl'>1e-10</span>, levels_low = <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, levels_high = <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>)
<span class='kw'>bands</span> <span class='op'>&lt;-</span> <span class='fu'>iso_to_sfg</span>(<span class='kw'>raw</span>)
<span class='kw'>iso</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sf.html'>st_sf</a></span>(id = <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='kw'>bands</span>)), geometry = <span class='fu'><a href='https://rdrr.io/pkg/sf/man/sfc.html'>st_sfc</a></span>(<span class='kw'>bands</span>))
<span class='fu'><a href='https://rdrr.io/pkg/sf/man/valid.html'>st_is_valid</a></span>(<span class='kw'>iso</span>, reason = <span class='fl'>TRUE</span>)
</div><div class='output co'>#&gt; [1] "Valid Geometry" "Valid Geometry"</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Claus O. Wilke, Thomas Lin Pedersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


